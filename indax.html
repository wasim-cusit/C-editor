<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C++ Editor - Mobile Responsive</title>
    
    <!-- CodeMirror CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: calc(100vh - 20px);
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .header-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }

        .btn-primary:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .btn-secondary:hover {
            background: rgba(255,255,255,0.3);
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .btn-danger:hover {
            background: #da190b;
        }

        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
            flex-direction: column;
        }

        .editor-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        .editor-wrapper {
            flex: 1;
            position: relative;
            border-bottom: 2px solid #e0e0e0;
        }

        .CodeMirror {
            height: 100% !important;
            font-size: 14px;
            line-height: 1.6;
        }

        .output-container {
            height: 9.375rem;
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            display: flex;
            flex-direction: column;
        }

        .output-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid #444;
            flex-shrink: 0;
        }

        .output-header h3 {
            color: #fff;
            font-size: 1rem;
        }

        .output-content {
            white-space: pre-wrap;
            word-wrap: break-word;
            flex: 1;
            overflow-y: auto;
            line-height: 1.6;
        }

        .input-section {
            padding: 10px;
            background: #2d2d2d;
            border-top: 1px solid #444;
            flex-shrink: 0;
        }

        .input-section label {
            display: block;
            color: #fff;
            font-size: 0.85rem;
            margin-bottom: 5px;
        }

        .input-section textarea {
            width: 100%;
            background: #1e1e1e;
            color: #d4d4d4;
            border: 1px solid #444;
            border-radius: 4px;
            padding: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            resize: vertical;
            min-height: 40px;
        }

        .output-content.success {
            color: #4CAF50;
        }

        .output-content.error {
            color: #f44336;
        }

        .output-content.info {
            color: #2196F3;
        }

        .output-content a {
            color: #4CAF50;
            text-decoration: underline;
        }

        .output-content a:hover {
            color: #45a049;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }

            .container {
                height: calc(100vh - 10px);
                border-radius: 8px;
            }

            .header {
                padding: 12px 15px;
            }

            .header h1 {
                font-size: 1.2rem;
            }

            .header-controls {
                width: 100%;
                justify-content: flex-start;
            }

            .btn {
                padding: 6px 12px;
                font-size: 0.85rem;
                flex: 1;
                justify-content: center;
                min-width: 80px;
            }

            .CodeMirror {
                font-size: 13px;
            }

            .output-container {
                height: 180px;
                padding: 12px;
                font-size: 12px;
            }

            .output-header h3 {
                font-size: 0.9rem;
            }

            .input-section {
                padding: 8px;
            }

            .input-section label {
                font-size: 0.8rem;
            }

            .input-section textarea {
                font-size: 11px;
                min-height: 35px;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1rem;
            }

            .btn {
                padding: 5px 10px;
                font-size: 0.8rem;
            }

            .CodeMirror {
                font-size: 12px;
            }

            .output-container {
                height: 300px;
                font-size: 11px;
            }

            .input-section {
                padding: 6px;
            }

            .input-section textarea {
                font-size: 10px;
                min-height: 30px;
            }
        }

        /* Loading spinner */
        .spinner {
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top: 3px solid white;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        /* File input hidden */
        #fileInput {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ö° C++ Editor</h1>
            <div class="header-controls">
                <button class="btn btn-secondary" onclick="loadFile()">
                    üìÅ Load
                </button>
                <button class="btn btn-secondary" onclick="saveFile()">
                    üíæ Save
                </button>
                <button class="btn btn-secondary" onclick="clearEditor()">
                    üóëÔ∏è Clear
                </button>
                <button class="btn btn-primary" onclick="runCode()" id="runBtn">
                    ‚ñ∂Ô∏è Run
                </button>
            </div>
        </div>

        <div class="main-content">
            <div class="editor-container">
                <div class="editor-wrapper">
                    <textarea id="codeEditor"></textarea>
                </div>
            </div>

            <div class="output-container">
                <div class="output-header">
                    <h3>Output</h3>
                    <button class="btn btn-danger" onclick="clearOutput()" style="padding: 4px 8px; font-size: 0.8rem;">
                        Clear
                    </button>
                </div>
                <div class="output-content" id="output"></div>
                <div class="input-section">
                    <label for="stdinInput">Input (stdin):</label>
                    <textarea id="stdinInput" placeholder="Enter input for your program here..."></textarea>
                </div>
            </div>
        </div>
    </div>

    <input type="file" id="fileInput" accept=".cpp,.c,.h,.hpp,.txt">

    <!-- CodeMirror JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/clike/clike.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closebrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/matchbrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/selection/active-line.min.js"></script>

    <script>
        // Initialize CodeMirror
        const editor = CodeMirror.fromTextArea(document.getElementById('codeEditor'), {
            mode: 'text/x-c++src',
            theme: 'monokai',
            lineNumbers: true,
            indentUnit: 4,
            indentWithTabs: false,
            smartIndent: true,
            lineWrapping: true,
            matchBrackets: true,
            autoCloseBrackets: true,
            styleActiveLine: true,
            viewportMargin: Infinity
        });

        // Default C++ code
        const defaultCode = `#include <iostream>
using namespace std;

int main() {
    cout << "Hello, World!" << endl;
    return 0;
}`;

        editor.setValue(defaultCode);

        // Auto-save to localStorage
        editor.on('change', function() {
            localStorage.setItem('cpp_code', editor.getValue());
        });

        // Load from localStorage on page load
        window.addEventListener('load', function() {
            const savedCode = localStorage.getItem('cpp_code');
            if (savedCode) {
                editor.setValue(savedCode);
            }
        });

        // Run Code Function
        async function runCode() {
            const code = editor.getValue();
            const stdin = document.getElementById('stdinInput').value || '';
            const outputDiv = document.getElementById('output');
            const runBtn = document.getElementById('runBtn');
            
            if (!code.trim()) {
                outputDiv.innerHTML = '<span class="error">Error: No code to run!</span>';
                return;
            }

            // Show loading state
            runBtn.innerHTML = '<span class="spinner"></span> Running...';
            runBtn.disabled = true;

            outputDiv.innerHTML = '<span class="info">Compiling and running your code...</span>';

            try {
                // Using Judge0 API (free public API for code execution)
                const response = await fetch('https://judge0-ce.p.rapidapi.com/submissions?base64_encoded=false&wait=true', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-RapidAPI-Key': 'YOUR_API_KEY', // Free tier available at rapidapi.com
                        'X-RapidAPI-Host': 'judge0-ce.p.rapidapi.com'
                    },
                    body: JSON.stringify({
                        language_id: 54, // C++ (GCC 9.2.0)
                        source_code: code,
                        stdin: stdin,
                        cpu_time_limit: 2,
                        memory_limit: 128000
                    })
                });

                if (!response.ok) {
                    throw new Error('API request failed');
                }

                const result = await response.json();

                // Display results
                let output = '';
                
                if (result.compile_output) {
                    output += `<span class="error">‚ùå Compilation Error:\n${escapeHtml(result.compile_output.trim())}</span>`;
                } else if (result.stderr) {
                    output += `<span class="error">‚ùå Runtime Error:\n${escapeHtml(result.stderr.trim())}</span>`;
                    if (result.stdout) {
                        output += `\n\n<span class="success">Output before error:\n${escapeHtml(result.stdout.trim())}</span>`;
                    }
                } else if (result.stdout) {
                    output += `<span class="success">‚úÖ Output:\n${escapeHtml(result.stdout.trim())}</span>`;
                } else {
                    output += `<span class="info">‚úì Code executed successfully (no output)</span>`;
                }

                if (result.status && result.status.description) {
                    const statusColor = result.status.id === 3 ? 'success' : (result.status.id >= 4 ? 'error' : 'info');
                    output += `\n\n<span class="${statusColor}">Status: ${escapeHtml(result.status.description)}</span>`;
                }

                if (result.time) {
                    output += `\n<span class="info">‚è± Time: ${result.time}s</span>`;
                }

                if (result.memory) {
                    output += ` | <span class="info">üíæ Memory: ${(result.memory / 1024).toFixed(2)} MB</span>`;
                }

                outputDiv.innerHTML = output;
                
            } catch (error) {
                // Fallback: Try alternative free API or show helpful message
                try {
                    // Alternative: Using Piston API (free, no auth required)
                    const pistonResponse = await fetch('https://emkc.org/api/v2/piston/execute', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            language: 'cpp',
                            version: '*',
                            files: [{
                                content: code
                            }],
                            stdin: stdin
                        })
                    });

                    if (pistonResponse.ok) {
                        const pistonResult = await pistonResponse.json();
                        let output = '';
                        
                        if (pistonResult.compile && pistonResult.compile.stderr) {
                            output += `<span class="error">‚ùå Compilation Error:\n${escapeHtml(pistonResult.compile.stderr.trim())}</span>`;
                        } else if (pistonResult.run && pistonResult.run.stderr) {
                            output += `<span class="error">‚ùå Runtime Error:\n${escapeHtml(pistonResult.run.stderr.trim())}</span>`;
                            if (pistonResult.run.output) {
                                output += `\n\n<span class="success">Output before error:\n${escapeHtml(pistonResult.run.output.trim())}</span>`;
                            }
                        } else if (pistonResult.run && pistonResult.run.output) {
                            output += `<span class="success">‚úÖ Output:\n${escapeHtml(pistonResult.run.output.trim())}</span>`;
                        } else {
                            output = '<span class="info">‚úì Code executed successfully (no output)</span>';
                        }
                        
                        if (pistonResult.run && pistonResult.run.code !== undefined) {
                            output += `\n\n<span class="info">Exit Code: ${pistonResult.run.code}</span>`;
                        }
                        
                        outputDiv.innerHTML = output;
                    } else {
                        throw new Error('Piston API failed');
                    }
                } catch (fallbackError) {
                    // Final fallback: Simple code analysis and helpful message
                    outputDiv.innerHTML = `
                        <span class="info">‚ö†Ô∏è Online compilation service unavailable.</span>
                        <br><br>
                        <span class="info">To enable code execution:</span>
                        <br>
                        <span style="color: #d4d4d4;">1. Get a free API key from <a href="https://rapidapi.com/judge0-official/api/judge0-ce" target="_blank" style="color: #4CAF50;">RapidAPI Judge0</a></span>
                        <br>
                        <span style="color: #d4d4d4;">2. Replace 'YOUR_API_KEY' in the code with your key</span>
                        <br><br>
                        <span class="success">Your code has been saved and is ready to compile!</span>
                        <br><br>
                        <span class="info">Code Preview:</span>
                        <pre style="margin-top: 10px; color: #d4d4d4; font-size: 11px;">${escapeHtml(code.substring(0, 500))}${code.length > 500 ? '...' : ''}</pre>
                    `;
                }
            } finally {
                runBtn.innerHTML = '‚ñ∂Ô∏è Run';
                runBtn.disabled = false;
            }
        }

        // Save File Function
        function saveFile() {
            const code = editor.getValue();
            const blob = new Blob([code], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'code.cpp';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showMessage('File saved successfully!', 'success');
        }

        // Load File Function
        function loadFile() {
            document.getElementById('fileInput').click();
        }

        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    editor.setValue(e.target.result);
                    showMessage('File loaded successfully!', 'success');
                };
                reader.readAsText(file);
            }
        });

        // Clear Editor Function
        function clearEditor() {
            if (confirm('Are you sure you want to clear the editor?')) {
                editor.setValue('');
                localStorage.removeItem('cpp_code');
                showMessage('Editor cleared!', 'info');
            }
        }

        // Clear Output Function
        function clearOutput() {
            document.getElementById('output').innerHTML = '';
        }

        // Utility Functions
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showMessage(message, type) {
            const outputDiv = document.getElementById('output');
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            outputDiv.innerHTML = `<span class="${className}">${message}</span>`;
        }

        // Keyboard shortcuts
        editor.setOption("extraKeys", {
            "Ctrl-S": function(cm) {
                saveFile();
            },
            "Ctrl-Enter": function(cm) {
                runCode();
            },
            "F11": function(cm) {
                cm.setOption("fullScreen", !cm.getOption("fullScreen"));
            },
            "Esc": function(cm) {
                if (cm.getOption("fullScreen")) cm.setOption("fullScreen", false);
            }
        });

        // Handle window resize for mobile
        window.addEventListener('resize', function() {
            editor.refresh();
        });

        // Touch-friendly adjustments for mobile
        if ('ontouchstart' in window) {
            document.body.style.cursor = 'pointer';
        }
    </script>
</body>
</html>

